<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>Student Management System</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="container py-4">

<h1 class="mb-4">Student Management System</h1>

<div class="row">
    <div class="col-md-5">
        <h4>Add / Edit Student</h4>
        <form id="form">
            <input type="hidden" id="id">
            <div class="mb-2">
                <input id="firstName" class="form-control" placeholder="First name" required>
            </div>
            <div class="mb-2">
                <input id="lastName" class="form-control" placeholder="Last name">
            </div>
            <div class="mb-2">
                <input id="email" class="form-control" placeholder="Email" type="email" required>
            </div>
            <div class="mb-2">
                <input id="course" class="form-control" placeholder="Course">
            </div>
            <div class="mb-2">
                <input id="phone" class="form-control" placeholder="Phone">
            </div>
            <button class="btn btn-primary" type="submit">Save</button>
            <button id="cancelBtn" type="button" class="btn btn-secondary ms-2">Cancel</button>
        </form>
    </div>

    <div class="col-md-7">
        <h4>Students</h4>
        <table class="table table-striped" id="table">
            <thead>
            <tr><th>ID</th><th>Name</th><th>Email</th><th>Course</th><th>Phone</th><th>Action</th></tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</div>

<script>
    const API_BASE = '/api/students';

    async function fetchAll(){
      const res = await fetch(API_BASE);
      const data = await res.json();
      const tbody = document.querySelector('#table tbody');
      tbody.innerHTML = '';
      data.forEach(s => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${s.id}</td>
          <td>${s.firstName} ${s.lastName || ''}</td>
          <td>${s.email}</td>
          <td>${s.course || ''}</td>
          <td>${s.phone || ''}</td>
          <td>
            <button class="btn btn-sm btn-info" onclick="edit(${s.id})">Edit</button>
            <button class="btn btn-sm btn-danger" onclick="del(${s.id})">Delete</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    document.getElementById('form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const id = document.getElementById('id').value;
      const payload = {
        firstName: document.getElementById('firstName').value,
        lastName: document.getElementById('lastName').value,
        email: document.getElementById('email').value,
        course: document.getElementById('course').value,
        phone: document.getElementById('phone').value
      };
      if(id){
        await fetch(`${API_BASE}/${id}`, {
          method: 'PUT',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify(payload)
        });
      } else {
        await fetch(API_BASE, {
          method: 'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify(payload)
        });
      }
      resetForm();
      fetchAll();
    });

    document.getElementById('cancelBtn').addEventListener('click', resetForm);

    function resetForm(){
      document.getElementById('id').value = '';
      document.getElementById('firstName').value = '';
      document.getElementById('lastName').value = '';
      document.getElementById('email').value = '';
      document.getElementById('course').value = '';
      document.getElementById('phone').value = '';
    }

    async function edit(id){
      const res = await fetch(`${API_BASE}/${id}`);
      const s = await res.json();
      document.getElementById('id').value = s.id;
      document.getElementById('firstName').value = s.firstName;
      document.getElementById('lastName').value = s.lastName || '';
      document.getElementById('email').value = s.email;
      document.getElementById('course').value = s.course || '';
      document.getElementById('phone').value = s.phone || '';
    }

    async function del(id){
      if(!confirm('Delete student?')) return;
      await fetch(`${API_BASE}/${id}`, { method: 'DELETE' });
      fetchAll();
    }

    fetchAll();
</script>

</body>
</html>
